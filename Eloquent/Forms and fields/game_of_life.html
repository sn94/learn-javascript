<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="content-type" content="text/html" />
	<meta name="author" content="Sonia" />

	<title>Conway's Game of Life</title>
</head>

<body>
   
<div id="grid">
 
</div>

 
<button onclick="survive()" >Next generation</button>


 </body>
 <script>
  

var GameOfLife= 
function(){
    return {
    rows: 30,
    cols: 15,
    checkboxes: [],
    gen_random_states: function(){
 
 let ran=[];
 for(let a=0; a< this.rows* this.cols ; a++){
    ran.push(  Math.random() < 0.5) ;
 } return ran;
  },
  set_random_states:   function  (  states){
    
    this.checkboxes.forEach(function( val, indice){
        val.checked=  states[indice];
    });
  },
  trans_index: function ( i, j){  
    
    if( j >= this.cols ||  i == this.rows) j= this.cols-1;
    if( i >= this.rows) i= this.rows-1;
    
    return  i * this.cols  + j;  },

   trans_index_r: function ( indice){  
    let i=0; //numero de fila que corresponde al (indice)esimo elemento de la lista de checkboxes
    let k=0;//contador para iterar el  numero de filas de la grilla de checkboxes
    for(k=0; k< this.rows; k++){
         
    let referencia=  this.trans_index( k,0) ; //Se obtiene el indice (secuencial) del elemento a partir
                                        //de proporcionar fila y columna
                                        //Se obtiene el indice que corresponde a la fila k en la col. 0
    /** Si el indice secuencial obtenido es igual al otro indice secuencial: el parametro (indice)
    Se asume que la fila del elemento de indice "referencia" es k
    Se asigna k a i***/
    if( indice == referencia){    
         i= k; break;//Encontrada la fila se interrumpe el bucle
         }

    /** El parametro de indice es mayor al de referencia y (menor o igual) al indice secuencial de la
    siguiente fila en la columna cero 
    El elemento se encuentra entre esos intervalos
    **/
    if( indice > referencia && indice  <=  this.trans_index( k+1 ,0) ){ 
        i= k; break;}
        
    }
    
   let j=  indice - i * this.cols;//A partir de la fila y el valor de indice secuencial se halla el numero
                            // de columna
    
    return  [i ,j ];
    },

    neighbours: function ( ci, cj ){
    
    let v1=  this.checkboxes[ this.trans_index( ci-1 ,  cj-1)].checked ? 1 : 0;
    let v2=  this.checkboxes[ this.trans_index( ci-1 ,  cj)].checked  ? 1 : 0;
    let v3=  this.checkboxes[ this.trans_index( ci-1 ,  cj+1)].checked ? 1 : 0;
    let v4=  this.checkboxes[ this.trans_index( ci ,  cj-1)].checked  ? 1 : 0;
    let v5=  this.checkboxes[ this.trans_index( ci ,  cj+1)].checked  ? 1 : 0;
    let v6=  this.checkboxes[ this.trans_index( ci+1 ,  cj-1)].checked  ? 1 : 0; 
    let v7=  this.checkboxes[ this.trans_index( ci+1 ,  cj)].checked  ? 1 : 0;
    let v8=  this.checkboxes[ this.trans_index( ci+1 ,  cj+1)].checked  ? 1 : 0;
    
    let finalsuma= v1+v2+v3+v4+v5+v6+v7+v8;
    console.log("vecinos ", finalsuma)
   return  finalsuma; 
  },
  survive: function ( i , j){
    //    fila * columnas  +  col 
    let sum= this.neighbours( i, j);
    if( this.checkboxes[  this.trans_index( i, j)].checked && (sum < 2 || sum> 3) ) return false;
    else{
     if(  this.checkboxes[ this.trans_index( i, j)].checked  &&  (sum == 3 || sum == 2)  )  return true;
    else{
        if( !this.checkboxes[ this.trans_index( i, j)].checked  && sum== 3 ) return true;
    }
    
       
    }
  },
  generate_grid: function ( gridname){
    let grilla= document.getElementById( gridname );
    
    for(let i=0; i<  this.rows; i++){
        for(let j=0; j< this.cols; j++){
            let checkbox= document.createElement("input");  checkbox.type="checkbox";
            //agregar a la lista
            this.checkboxes.push(checkbox);
            
            grilla.appendChild(  checkbox );
        }
    grilla.appendChild( document.createElement("br")); 
    } },
    update_grid: function (){
    this.checkboxes.forEach( function( curvalue, indice, arr){
        this.checkboxes[indice].checked= survive();
    })
  },



};
};
  
   
 
  
  function GridOfLife(){
 var game=GameOfLife();
 game.generate_grid( "grid");
game.set_random_states(game.gen_random_states() ); 
  console.log( "5,7 ", game.survive(5,7));
  }
  
  
  GridOfLife(); 
  
 </script>
</html>s
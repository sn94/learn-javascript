<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="content-type" content="text/html" />
	<meta name="author" content="Sonia" />

	<title>Conway's Game of Life</title>
</head>

<body>
   
<div id="grid">
 
</div>

 
<button onclick="survive()" >Next generation</button>


 </body>
 <script>
  
  
  const rows= 30, cols= 15;
  var checkboxes= [];
  
  
  
  function gen_random_states(){
 
 let ran=[];
 for(let a=0; a< rows*cols ; a++){
    ran.push(  Math.random() < 0.5) ;
 } return ran;
  }
  
  
  function set_random_states(  states){
    
    checkboxes.forEach(function( val, indice){
        val.checked=  states[indice];
    });
  }
  
  
  
  
  function trans_index( i, j){   return  i * cols  + j;  }
  
  function neighbour_x( ci, cj){
    let x=0; 
     //recorrer todos las columnas de su fila
      for( let j=cj+1 ; j< cols; j++){  //por la derecha
         if(checkboxes[  trans_index(ci, j)].checked  ){ 
            console.log(trans_index(ci, j), " j ", j); 
              x ++; 
         }  else {  break; } 
    }
     for( let j=cj-1 ; j>=0 ; j--){  //por la izquierda
         if(checkboxes[  trans_index(ci, j)].checked  ) {
            console.log( trans_index(ci, j), " j2 ", j); 
                x ++;  
         }else {  break; } 
    }
    console.log("    x final ", x);
     return x;
  }
  
  
  function neighbour_y( ci, cj){
     //recorrer todos las filas de su columna
     for( let i=ci+1 ; i< rows; i++){  //por abajo
         if(checkboxes[  trans_index(i, cj)].checked  )  
            this.y ++;
        else {  break; } 
    }
     for( let i=ci-1 ; i>=0 ; i--){  //por arriba
         if(checkboxes[  trans_index(i, cj)].checked  )  
            this.y ++;
        else {  break; } 
    } 
  }
  
  
  function neighbour_dia( ci,cj){
    
    
    //recorrer diagonal principal (y si nro fila fuera cero?)
    let ci_new= ci ? ci-1 : -1;
    let cj_new= cj ? cj-1 : -1;
    let j= cj_new;
      for( let i= ci_new ; i>=0 &&  j>=0; i--){  //por arriba
          
          if(checkboxes[  trans_index(i, j)].checked  ){
           
            neighbours_d ++; j--;    
          } else {  break; } 
    
    }
    
    ci_new= (ci+1) < rows ? ci+1 : rows;
    cj_new= (cj+1) < cols ? cj+1 : cols;
     j=  cj_new;
      for( let i= ci_new ; i< rows && j< cols ; i++){  //por abajo
         if(checkboxes[  trans_index(i, j)].checked  ){
             neighbours_d ++; j++; 
         }   
        else {  break; } 
    }


      //recorrer diagonal secundaria (y si nro fila la ultima?)
    ci_new= (ci-1) < rows ? ci-1 : -1;
    cj_new= (cj+1) < cols ? cj+1 : cols;
    j= cj_new;
      for( let i= ci_new ; i>=0 &&  j < cols  ; i--){  //por arriba
          
          if(checkboxes[  trans_index(i, j)].checked  ){
            
            neighbours_d ++; j++;
          } else {  break; } 
    
    }
    
    ci_new= (ci+1) < rows ? ci+1 : rows;
    cj_new= (cj-1) < cols ? cj-1 : -1;
     j=  cj_new;
      for( let i= ci_new ; i< rows && j>= 0; i++){  //por abajo
         if(checkboxes[  trans_index(i, j)].checked  ){
             neighbours_d ++; j--; 
         }   
        else {  break; } 
    }
    
  }


   function neighbours( ci, cj ){
   let nums= { x: 0,  y: 0, d:  0 };
   nums.x= neighbour_x( ci, cj);
   neighbour_y.call( nums,     ci, cj);
   neighbour_dia( nums, ci, cj);
   return  nums; 
  }
  
  
  function survive( i , j){
    //    fila * columnas  +  col
    
    let surv= neighbours( i, j);
    let sum= surv.x+ surv.y+surv.d;
    if( checkboxes[ trans_index( i, j)].checked && (sum < 2 || sum> 3) ) return false;
    else{
     if( checkboxes[ trans_index( i, j)].checked  &&  (sum == 3 || sum == 2)  )  return true;
    else{
        if( !checkboxes[ trans_index( i, j)].checked  && sum== 3 ) return true;
    }
    
       
    }
  }
  
  

  function generate_grid(){
    let grilla= document.getElementById("grid");
    
    for(let i=0; i< rows; i++){
        for(let j=0; j< cols; j++){
            let checkbox= document.createElement("input");  checkbox.type="checkbox";
            //agregar a la lista
            checkboxes.push(checkbox);
            
            grilla.appendChild(  checkbox );
        }
    grilla.appendChild( document.createElement("br")); 
    } }
  
  
 
  
  function GridOfLife(){
    
  generate_grid();
  set_random_states(  gen_random_states());
  console.log( "5,7 ", survive(5,7));
  }
  
  
  GridOfLife();
  
  
 </script>
</html>
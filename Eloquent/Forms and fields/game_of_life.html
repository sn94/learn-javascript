<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="content-type" content="text/html" />
	<meta name="author" content="Sonia" />

	<title>Conway's Game of Life</title>
</head>

<body>
   
<div id="grid">
 
</div>

 
<button onclick="survive()" >Next generation</button>


 </body>
 <script>
  
  
  const rows= 30, cols= 15;
  var checkboxes= [];
  
  
  
  function gen_random_states(){
 
 let ran=[];
 for(let a=0; a< rows*cols ; a++){
    ran.push(  Math.random() < 0.5) ;
 } return ran;
  }
  
  
  function set_random_states(  states){
    
    checkboxes.forEach(function( val, indice){
        val.checked=  states[indice];
    });
  }
  
  
  
  
  function trans_index( i, j){  
    
    if( j >= cols ||  i == rows) j= cols-1;
    if( i >= rows) i= rows-1;
    
    return  i * cols  + j;  }
      
   
   function trans_index_r( indice){  
    let i=0;
    let k=0
    for(k=0; k< rows; k++){
         
    let referencia=  trans_index( k,0) ; 
    if( indice == referencia){     i= k;}
    
    if( indice >= referencia && indice <=  trans_index( k+1 ,0) ){ 
        
        i= k;}
   
  
    }
    
   let j=  indice - i * cols;
    
    return  [i ,j ];
    }
   
   
  function neighbour_x( ci, cj){
    let x=0; 
     //recorrer todos las columnas de su fila
      for( let j=cj+1 ; j< cols; j++){  //por la derecha
         if(checkboxes[  trans_index(ci, j)].checked  ){ 
              x ++; 
         }  else {  break; } 
    }
     for( let j=cj-1 ; j>=0 ; j--){  //por la izquierda
         if(checkboxes[  trans_index(ci, j)].checked  ) { 
                x ++;  
         }else {  break; } 
    }
    console.log("Numero de vecinos de ("+ci+","+cj+") en horizontal", x);
     return x;
  }
  
  
  function neighbour_y( ci, cj){
      let y=0;
     //recorrer todos las filas de su columna
     for( let i=ci+1 ; i< rows; i++){  //por abajo
         if(checkboxes[  trans_index(i, cj)].checked  )  
            y ++;
        else {  break; } 
    }
     for( let i=ci-1 ; i>=0 ; i--){  //por arriba
         if(checkboxes[  trans_index(i, cj)].checked  )  
            y ++;
        else {  break; } 
    }   
     console.log("Numero de vecinos de ("+ci+","+cj+") en vertical", y); 
     return y;
  }
   
  
  function neighbour_dia( ci,cj){
    let neighbours_d= 0
    
    //recorrer diagonal principal (y si nro fila fuera cero?)
    let ci_new= ci ? ci-1 : -1;
    let cj_new= cj ? cj-1 : -1;
    let j= cj_new;
      for( let i= ci_new ; i>=0 &&  j>=0; i--){  //por arriba
          
          if(checkboxes[  trans_index(i, j)].checked  ){
           
            neighbours_d ++; j--;    
          } else {  break; } 
    
    }
    
    ci_new= (ci+1) < rows ? ci+1 : rows;
    cj_new= (cj+1) < cols ? cj+1 : cols;
     j=  cj_new;
      for( let i= ci_new ; i< rows && j< cols ; i++){  //por abajo
         if(checkboxes[  trans_index(i, j)].checked  ){
             neighbours_d ++; j++; 
         }   
        else {  break; } 
    }


      //recorrer diagonal secundaria (y si nro fila la ultima?)
    ci_new= (ci-1) < rows ? ci-1 : -1;
    cj_new= (cj+1) < cols ? cj+1 : cols;
    j= cj_new;
      for( let i= ci_new ; i>=0 &&  j < cols  ; i--){  //por arriba
          
          if(checkboxes[  trans_index(i, j)].checked  ){
            
            neighbours_d ++; j++;
          } else {  break; } 
    
    
    }
    
    ci_new= (ci+1) < rows ? ci+1 : rows;
    cj_new= (cj-1) < cols ? cj-1 : -1;
     j=  cj_new;
      for( let i= ci_new ; i< rows && j>= 0; i++){  //por abajo
         if(checkboxes[  trans_index(i, j)].checked  ){
             neighbours_d ++; j--; 
         }   
        else {  break; } 
    }
      console.log("Numero de vecinos de ("+ci+","+cj+") en diagonal",  neighbours_d ); 
    return neighbours_d;
  }


   function neighbours( ci, cj ){
    
    let v1= checkboxes[ trans_index( ci-1 ,  cj-1)].checked ? 1 : 0;
    let v2= checkboxes[ trans_index( ci-1 ,  cj)].checked  ? 1 : 0;
    let v3= checkboxes[ trans_index( ci-1 ,  cj+1)].checked ? 1 : 0;
    let v4= checkboxes[ trans_index( ci ,  cj-1)].checked  ? 1 : 0;
    let v5= checkboxes[ trans_index( ci ,  cj+1)].checked  ? 1 : 0;
    let v6= checkboxes[ trans_index( ci+1 ,  cj-1)].checked  ? 1 : 0; 
    let v7= checkboxes[ trans_index( ci+1 ,  cj)].checked  ? 1 : 0;
    let v8= checkboxes[ trans_index( ci+1 ,  cj+1)].checked  ? 1 : 0;
    
    let finalsuma= v1+v2+v3+v4+v5+v6+v7+v8;
    console.log("vecinos ", finalsuma)
   return  finalsuma; 
  }
  
  
  function survive( i , j){
    //    fila * columnas  +  col 
    let sum= neighbours( i, j);
    if( checkboxes[ trans_index( i, j)].checked && (sum < 2 || sum> 3) ) return false;
    else{
     if( checkboxes[ trans_index( i, j)].checked  &&  (sum == 3 || sum == 2)  )  return true;
    else{
        if( !checkboxes[ trans_index( i, j)].checked  && sum== 3 ) return true;
    }
    
       
    }
  }
  
  

  function generate_grid(){
    let grilla= document.getElementById("grid");
    
    for(let i=0; i< rows; i++){
        for(let j=0; j< cols; j++){
            let checkbox= document.createElement("input");  checkbox.type="checkbox";
            //agregar a la lista
            checkboxes.push(checkbox);
            
            grilla.appendChild(  checkbox );
        }
    grilla.appendChild( document.createElement("br")); 
    } }
  
  
  function update_grid(){
    checkboxes.forEach( function( curvalue, indice, arr){
        checkboxes[indice].checked= survive();
    })
  }
 
  
  function GridOfLife(){
    
  generate_grid();
  set_random_states(  gen_random_states());
  console.log( "5,7 ", survive(5,7));
  }
  
  
  GridOfLife();
  trans_index_r( 449);
  
 </script>
</html>